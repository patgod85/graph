/*! patgod85.graph 0.0.4 2014-10-28 */
!function(a){function b(b,d){function e(b){this.getCanvas=function(){function c(){f.addEventListener("mousemove",function(c){var g=d(f,c),h=null,i=[];k(function(a){Math.abs(g.x-a.x)<8&&Math.abs(g.y-a.y)<8?(h=a,a.hovered=!0):a.hovered=!1,i.push(a.hovered)});var m="Mouse position: "+g.x+","+g.y;if(h&&(m+=". Hovered point!"+h.x+" : "+h.y),i.toString()!=l.toString()&&e(),l=i,b.debug){var n=a("."+j);n.html(m)}},!1)}function d(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}function e(){i.clearRect(0,0,f.width,f.height),k(function(a){var c;a.hovered?(c=10,n(i,a)):c=5,i.setLineDash([0]),i.lineWidth=2,m(i,a,c),""!=a.descr&&(i.beginPath(),i.font="bold 10pt "+b.fontFamily,i.fillStyle=b.types[a.type].color,i.fillText(a.descr,a.x-10,a.y+15),i.closePath())})}var f=g(h),i=f.getContext("2d"),l=[];return e(),c(),f}}function f(a,b){this.getCanvas=function(){function e(){n.fillStyle=a.backgroundColor,n.fillRect(0,0,a.width,a.height)}function f(){n.lineWidth=2;for(var d=0;d<a.types.length;d++)m(n,new c(d,"",120*d+100,10,a,b,!0),5),n.beginPath(),n.fillStyle=a.axesDescriptionColor,n.fillText(" - "+a.types[d].description,120*d+107,14),n.closePath()}function h(){function c(){function c(b,c){var d=new Date;for(d.setTime(c);0!=d.getMinutes()||(d.getHours()-1)%a.stepsX!=0;)b?c+=6e4:c-=6e4,d.setTime(c);return c}function e(){var a=b.minX,c=new Date;c.setTime(a),n.fillText(c.format("%H:%M"),s(a)-30,b.y0+5),1==d.length&&n.fillText(c.format("%d %B %Y"),b.x0,b.y0+25)}function f(){var a=b.maxX,c=new Date;c.setTime(a),n.fillText(c.format("%H:%M"),s(a)+5,b.y0+5)}var g,h=0;if(e(),d.length>1)for(f(),g=0;g<a.stepsX;g++){var i=b.x0+g*b.stepX;i=s(c(!0,r(i))),n.beginPath(),n.moveTo(i,b.y0),n.lineTo(i,b.y0-a.height+2*a.marginY),n.stroke(),n.closePath();var j=new Date;j.setTime(r(i)),n.fillText(j.format("%H:%M"),i,b.y0+15),(0==g||h!=j.getDate())&&n.fillText(j.format("%d %B %Y"),i,b.y0+25),h=j.getDate()}}function e(){for(var c=0;c<a.stepsY;c++){var d=b.y0-c*b.stepY;n.beginPath(),n.moveTo(b.x0,d),n.lineTo(b.x0+a.width-2*a.marginX,d),n.stroke(),n.closePath()}}n.strokeStyle=a.axesColor,n.lineWidth=1,n.font="8pt "+a.fontFamily,n.fillStyle=a.axesDescriptionColor,n.beginPath(),n.lineWidth=1,n.moveTo(b.x0,a.marginY),n.lineTo(b.x0,b.y0),n.lineTo(a.width-a.marginX,b.y0),n.stroke(),n.closePath(),c(),e()}function j(){n.beginPath(),n.fillStyle=a.linesColor,n.strokeStyle=a.linesColor;var c,d=0;k(function(a){"undefined"==typeof c&&(c=a.x),n.lineTo(a.x,a.y),d=a.x}),n.lineWidth=2,n.stroke(),n.lineTo(d,b.y0),n.lineTo("undefined"!=typeof c?c:0,b.y0),n.fill(),n.closePath()}var l=g(i),n=l.getContext("2d");return e(),j(),h(),f(),l}}function g(a){var c=document.createElement("canvas");return c.setAttribute("height",b.height+"px"),c.setAttribute("width",b.width+"px"),c.setAttribute("class",a),c}function k(a){for(var b=0;b<u.length&&a(u[b])!==!1;b++);}function l(a){function b(a){if(4!=a.length)throw"Wrong input format. Array should have 4 elements";return{Type:a[0],Description:a[1],X:a[2],Y:a[3]}}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}for(var e,f,g=0;g<d.length;g++){if(c(d[g]))e=b(d[g]);else{if(e=d[g],!e.hasOwnProperty("Type"))throw"Wrong input format. Object should have the Type property";if(e.hasOwnProperty("Description")||(e.Description=""),isNaN(parseFloat(e.Y)))throw"Wrong input format. Y value can not be parsed as a float"}if(f=Date.parse(e.X),isNaN(f))throw"Wrong input format. Time can not be parsed";a(e.Type,e.Description,f,e.Y)}}function m(a,c,d){a.beginPath(),a.fillStyle=b.linesColor,a.strokeStyle=b.types[c.type].color,a.moveTo(c.x-d,c.y),a.lineTo(c.x,c.y-d),a.lineTo(c.x+d,c.y),a.lineTo(c.x,c.y+d),a.lineTo(c.x-d,c.y),a.fill(),a.stroke(),a.closePath()}function n(a,c){a.beginPath(),a.strokeStyle=b.types[c.type].color,a.lineWidth=1,a.setLineDash([3]),a.moveTo(t.x0,c.y),a.lineTo(c.x,c.y),a.lineTo(c.x,t.y0),a.stroke(),a.closePath(),a.beginPath(),a.setLineDash([0]),a.fillStyle=b.types[c.type].color,a.strokeStyle=b.types[c.type].color,a.moveTo(c.x,c.y-14),a.lineTo(c.x-8,c.y-20),a.lineTo(c.x+8,c.y-20),a.lineTo(c.x,c.y-14),a.fill(),a.rect(c.x-30,c.y-40,60,20),a.fill(),a.stroke(),a.closePath(),a.beginPath(),a.fillStyle="white",a.font="bold 10pt "+b.fontFamily,a.fillText(c.origY.toString(),c.x-20,c.y-25),a.stroke(),a.closePath()}function o(a){var b={width:1280,height:1024,marginX:50,marginY:50,backgroundColor:"white",axesColor:"#DEDEDE",axesDescriptionColor:"#979797",linesColor:"#D9F1FD",fontFamily:"Tahoma",stepsX:8,stepsY:5,yK:1.5,debug:!1,types:[{color:"#39A8EC",description:"ваша ставка"},{color:"#0457AB",description:"другая компания"}]};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function p(){var a=0,c=0,e=Number.MAX_VALUE,f=Number.MAX_VALUE;l(function(b,d,g,h){a=Math.max(g,a),c=Math.max(h,c),e=Math.min(g,e),f=Math.min(h,f)});var g,h,i;return d.length>1?(g=(b.width-2*b.marginX)/(a-e),h=(b.height/b.yK-2*b.marginY)/(c-f),i=(a-e)/b.stepsX):(g=b.width-2*b.marginX/100,h=(b.height/b.yK-2*b.marginY)/100,i=100/b.stepsX),{coefficientX:g,coefficientY:h,x0:parseInt(b.marginX,10),y0:b.height-b.marginY,minX:e,maxX:a,minY:f,stepTime:i,stepX:i*g,stepY:(b.height-2*b.marginY)/b.stepsY}}function q(){var a=[];return l(function(d,e,f,g){a.push(new c(d,e,f,g,b,t))}),a}function r(a){return(a-t.x0)/t.coefficientX+t.minX}function s(a){return(a-t.minX+t.x0/t.coefficientX)*t.coefficientX}this.appendTo=function(a){for(var c=[new f(b,t).getCanvas(),new e(b).getCanvas()],d=0;d<c.length;d++)a.append(c[d])},this.getInternals=function(){return{timeToX:s,xToTime:r}},b=o(b);var t=p(),u=q()}function c(a,b,c,d,e,f,g){var h,i;return g?(h=c,i=d):(h=f.coefficientX*(c-f.minX)+e.marginX,i=e.height/e.yK-f.coefficientY*(d-f.minY)-e.marginY),{origX:c,origY:d,x:h,y:i,hovered:!1,type:a,descr:b}}function d(){Date.prototype.format||(Date.prototype.format=function(a){var b,c=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],d={Y:this.getFullYear(),y:this.getFullYear()-(this.getFullYear()>=2e3?2e3:1900),m:this.getMonth()+1,d:this.getDate(),H:this.getHours(),M:this.getMinutes(),S:this.getSeconds(),B:c[this.getMonth()]};for(b in d)d.hasOwnProperty(b)&&(a=a.replace("%"+b,d[b]<10?"0"+d[b]:d[b]));return a})}function e(){this.appendTo=function(a){var b=document.createElement("style");b.setAttribute("type","text/css"),b.innerHTML=".p85-graph-holder {position: relative; border: 1px solid grey;} ."+h+" {position: absolute; top:0; left:0;}",a.append(b)}}function f(){this.appendTo=function(a){var b=document.createElement("p");b.setAttribute("class",j),a.append(b)}}var g="p85-graph-holder",h="p85GraphCanvasFg",i="p85GraphCanvasBg",j="p85GraphStatusBar";a.fn.graph=function(a,c,h){return"internals"===h?b:("undefined"==typeof a&&(a={}),"undefined"==typeof c?this:(d(),this.addClass(g),(new e).appendTo(this),new b(a,c).appendTo(this),(new f).appendTo(this),this))}}(jQuery);