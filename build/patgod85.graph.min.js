/*! patgod85.graph 0.0.6 2014-10-29 */
!function(a){function b(b,d){function e(b){function c(c){function d(){var c=a("<div></div>");c.addClass("patgod85-graph-tooltip");var d={left:this.point.x,top:this.point.y-40};d["background-color"]=b.types[this.point.type].color,c.css(d),c.html(this.point.origY);var e=a(this).parents("."+i);c.appendTo(e);var f=a("<div></div>");f.addClass("patgod85-graph-tooltip-lines"),f.css({left:t.x0,top:this.point.y,width:this.point.x-t.x0,height:t.y0-this.point.y}),f.appendTo(e)}function e(){a(".patgod85-graph-tooltip").remove(),a(".patgod85-graph-tooltip-lines").remove()}m(function(b){var f=a(g("rhomb-tmpl-a")),h={top:b.y,left:b.x};f.addClass("p85-graph-point-type"+b.type),f.css(h),f.prop("point",b),f.hover(d,e),f.appendTo(c);var i=a("<div></div>");i.addClass("p85-graph-point-description"),i.html(b.descr),i.css({top:b.y+10,left:b.x-10}),i.appendTo(c)})}this.getCanvas=function(){var b=a('<div class="'+i+'"></div>');return c(b),b}}function h(b){function c(c){for(var d=0;d<b.types.length;d++){var e=a(g("rhomb-tmpl-div"));e.addClass("p85-graph-point-type"+d),e.appendTo(c);var f=a("<span></span>");f.html(" - "+b.types[d].description),f.appendTo(c)}}this.getCanvas=function(){var b=a('<div class="p85-graph-agenda"></div>');return c(b),b}}function k(a,b){this.getCanvas=function(){function c(){h.fillStyle=a.backgroundColor,h.fillRect(0,0,a.width,a.height)}function e(){function c(){function c(b,c){var d=new Date;for(d.setTime(c);0!=d.getMinutes()||(d.getHours()-1)%a.stepsX!=0;)b?c+=6e4:c-=6e4,d.setTime(c);return c}function e(){var a=b.minX,c=new Date;c.setTime(a),h.fillText(c.format("%H:%M"),r(a)-30,b.y0+5),1==d.length&&h.fillText(c.format("%d %B %Y"),b.x0,b.y0+25)}function f(){var a=b.maxX,c=new Date;c.setTime(a),h.fillText(c.format("%H:%M"),r(a)+5,b.y0+5)}var g,i=0;if(e(),d.length>1)for(f(),g=0;g<a.stepsX;g++){var j=b.x0+g*b.stepX;j=r(c(!0,q(j))),h.beginPath(),h.moveTo(j,b.y0),h.lineTo(j,b.y0-a.height+2*a.marginY),h.stroke(),h.closePath();var k=new Date;k.setTime(q(j)),h.fillText(k.format("%H:%M"),j,b.y0+15),(0==g||i!=k.getDate())&&h.fillText(k.format("%d %B %Y"),j,b.y0+25),i=k.getDate()}}function e(){for(var c=0;c<a.stepsY;c++){var d=b.y0-c*b.stepY;h.beginPath(),h.moveTo(b.x0,d),h.lineTo(b.x0+a.width-2*a.marginX,d),h.stroke(),h.closePath()}}h.strokeStyle=a.axesColor,h.lineWidth=1,h.font="8pt "+a.fontFamily,h.fillStyle=a.axesDescriptionColor,h.beginPath(),h.lineWidth=1,h.moveTo(b.x0,a.marginY),h.lineTo(b.x0,b.y0),h.lineTo(a.width-a.marginX,b.y0),h.stroke(),h.closePath(),c(),e()}function f(){h.beginPath(),h.fillStyle=a.linesColor,h.strokeStyle=a.linesColor;var c,d=0;m(function(a){"undefined"==typeof c&&(c=a.x),h.lineTo(a.x,a.y),d=a.x}),h.lineWidth=2,h.stroke(),h.lineTo(d,b.y0),h.lineTo("undefined"!=typeof c?c:0,b.y0),h.fill(),h.closePath()}var g=l(j),h=g.getContext("2d");return c(),f(),e(),g}}function l(a){var c=document.createElement("canvas");return c.setAttribute("height",b.height+"px"),c.setAttribute("width",b.width+"px"),c.setAttribute("class",a),c}function m(a){for(var b=0;b<u.length&&a(u[b])!==!1;b++);}function n(a){function b(a){if(4!=a.length)throw"Wrong input format. Array should have 4 elements";return{Type:a[0],Description:a[1],X:a[2],Y:a[3]}}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}for(var e,f,g=0;g<d.length;g++){if(c(d[g]))e=b(d[g]);else{if(e=d[g],!e.hasOwnProperty("Type"))throw"Wrong input format. Object should have the Type property";if(e.hasOwnProperty("Description")||(e.Description=""),isNaN(parseFloat(e.Y)))throw"Wrong input format. Y value can not be parsed as a float"}if(f=Date.parse(e.X),isNaN(f))throw"Wrong input format. Time can not be parsed";a(e.Type,e.Description,f,e.Y)}}function o(){var a=0,c=0,e=Number.MAX_VALUE,f=Number.MAX_VALUE;n(function(b,d,g,h){a=Math.max(g,a),c=Math.max(h,c),e=Math.min(g,e),f=Math.min(h,f)});var g,h,i;return d.length>1?(g=(b.width-2*b.marginX)/(a-e),h=(b.height/b.yK-2*b.marginY)/(c-f),i=(a-e)/b.stepsX):(g=b.width-2*b.marginX/100,h=(b.height/b.yK-2*b.marginY)/100,i=100/b.stepsX),{coefficientX:g,coefficientY:h,x0:parseInt(b.marginX,10),y0:b.height-b.marginY,minX:e,maxX:a,minY:f,stepTime:i,stepX:i*g,stepY:(b.height-2*b.marginY)/b.stepsY}}function p(){var a=[];return n(function(d,e,f,g){a.push(new c(d,e,f,g,b,t))}),a}function q(a){return(a-t.x0)/t.coefficientX+t.minX}function r(a){return(a-t.minX+t.x0/t.coefficientX)*t.coefficientX}function s(a){this.getElement=function(){for(var b=document.createElement("style"),c=".p85-graph-holder {font-family: "+a.fontFamily+"}",d=0;d<a.types.length;d++){var e=a.types[d].color;c+=".p85-graph-point-type"+d+" .rhomb-up { border-bottom-color: "+e+"; } .p85-graph-point-type"+d+" .rhomb-down { border-top-color: "+e+"; }"}return b.setAttribute("type","text/css"),b.innerHTML=c,b}}this.appendTo=function(a){for(var c=[new k(b,t).getCanvas(),new h(b).getCanvas(),new e(b).getCanvas(),new s(b).getElement()],d=0;d<c.length;d++)a.append(c[d])},this.getInternals=function(){return{timeToX:r,xToTime:q,params:t}},b=f(b);var t=o(),u=p()}function c(a,b,c,d,e,f,g){var h,i;return g?(h=c,i=d):(h=f.coefficientX*(c-f.minX)+e.marginX,i=e.height/e.yK-f.coefficientY*(d-f.minY)-e.marginY),{origX:c,origY:d,x:h,y:i,hovered:!1,type:a,descr:b}}function d(){Date.prototype.format||(Date.prototype.format=function(a){var b,c=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],d={Y:this.getFullYear(),y:this.getFullYear()-(this.getFullYear()>=2e3?2e3:1900),m:this.getMonth()+1,d:this.getDate(),H:this.getHours(),M:this.getMinutes(),S:this.getSeconds(),B:c[this.getMonth()]};for(b in d)d.hasOwnProperty(b)&&(a=a.replace("%"+b,d[b]<10?"0"+d[b]:d[b]));return a})}function e(){this.appendTo=function(a){var b=document.createElement("p");b.setAttribute("class",k),a.append(b)}}function f(a){var b={width:1280,height:1024,marginX:50,marginY:50,backgroundColor:"white",axesColor:"#DEDEDE",axesDescriptionColor:"#979797",linesColor:"#D9F1FD",fontFamily:"Tahoma, serif",stepsX:8,stepsY:5,yK:1.5,debug:!1,types:[{color:"#39A8EC",description:"ваша ставка"},{color:"#0457AB",description:"другая компания"}]};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function g(a){switch(a){case"rhomb-tmpl-div":return'<div class="p85-graph-point"><div class="rhomb-up"></div><div class="rhomb-down"></div></div>';case"rhomb-tmpl-a":return'<a href="#" class="p85-graph-point"><div class="rhomb-up"></div><div class="rhomb-down"></div></a>';default:return""}}var h="p85-graph-holder",i="p85GraphCanvasFg",j="p85GraphCanvasBg",k="p85GraphStatusBar";a.fn.graph=function(a,c,f){return"internals"===f?b:("undefined"==typeof a&&(a={}),"undefined"==typeof c?this:(d(),this.addClass(h),new b(a,c).appendTo(this),(new e).appendTo(this),this))}}(jQuery);