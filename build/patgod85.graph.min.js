/*! patgod85.graph 0.0.10 2015-03-20 */

!function(a){function b(b,e){function h(b){function c(c){function d(){var c=a("<div></div>");c.addClass("patgod85-graph-tooltip");var d={left:this.point.x,top:this.point.y-40};d["background-color"]=b.types[this.point.type].color,c.css(d),c.html(this.point.origY);var e=a(this).parents("."+i);c.appendTo(e);var f=a("<div></div>");f.addClass("patgod85-graph-tooltip-lines"),f.css({left:u.x0,top:this.point.y,width:this.point.x-u.x0,height:u.y0-this.point.y}),f.appendTo(e)}function e(){a(".patgod85-graph-tooltip").remove(),a(".patgod85-graph-tooltip-lines").remove()}n(function(b){var f=a(g("rhomb-tmpl-a")),h={top:b.y,left:b.x};f.addClass("p85-graph-point-type"+b.type),f.css(h),f.prop("point",b),f.hover(d,e),f.appendTo(c);var i=a("<div></div>");i.addClass("p85-graph-point-description"),i.html(b.descr),i.css({top:b.y+10,left:b.x-10}),i.appendTo(c)})}this.getCanvas=function(){var b=a('<div class="'+i+'"></div>');return c(b),b}}function k(b){function c(c){for(var d=0;d<b.types.length;d++){var e=a(g("rhomb-tmpl-div"));e.addClass("p85-graph-point-type"+d),e.appendTo(c);var f=a("<span></span>");f.html(" - "+b.types[d].description),f.appendTo(c)}}this.getCanvas=function(){var b=a('<div class="p85-graph-agenda"></div>');return c(b),b}}function l(a,b){this.getCanvas=function(){function c(){i.fillStyle=a.backgroundColor,i.fillRect(0,0,a.width,a.height)}function f(){function c(){function c(c,d){var e=new Date;e.setTime(d);var f=[0],g=(b.maxX-b.minX)/1e3/60/60;for(1>g?f=[0,15,30,45,5,10,20,25,35,40,50,55]:3>g?f=[0,15,30,45,10,20,40,50]:g<a.stepsX&&(f=[0,15,30,45]);-1===f.indexOf(e.getMinutes());)c?d+=6e4:d-=6e4,e.setTime(d);return d}function f(){var a=b.minX,c=new Date;c.setTime(a),i.fillText(d(c,"%H:%M"),s(a)-30,b.y0+5),1==e.length&&i.fillText(d(c,"%d %B %Y"),b.x0,b.y0+25)}function g(){var a=b.maxX,c=new Date;c.setTime(a),i.fillText(d(c,"%H:%M"),s(a)+5,b.y0+5)}var h,j,k=0,l=0,m=0;if(f(),e.length>1)for(g(),h=0;h<a.stepsX;h++){j=b.x0+h*b.stepX,k>=j&&(j=k),j=s(c(!0,r(j))),w.push(j-b.x0),i.beginPath(),i.moveTo(j,b.y0),i.lineTo(j,b.y0-a.height+2*a.marginY),i.stroke(),i.closePath();var n=new Date;n.setTime(r(j)),i.fillText(d(n,"%H:%M"),j,b.y0+15),(0==h||l!=n.getDate())&&(i.fillText(d(n,"%d %B"),j,b.y0+30),(0==h||m!=n.getFullYear())&&i.fillText(d(n,"%Y"),j,b.y0+45)),l=n.getDate(),m=n.getFullYear(),k=j}}function f(){for(var c=0;c<a.stepsY;c++){var d=b.y0-c*b.stepY;i.beginPath(),i.moveTo(b.x0,d),i.lineTo(b.x0+a.width-2*a.marginX,d),i.stroke(),i.closePath()}}i.strokeStyle=a.axesColor,i.lineWidth=1,i.font="8pt "+a.fontFamily,i.fillStyle=a.axesDescriptionColor,i.beginPath(),i.lineWidth=1,i.moveTo(b.x0,a.marginY),i.lineTo(b.x0,b.y0),i.lineTo(a.width-a.marginX,b.y0),i.stroke(),i.closePath(),c(),f()}function g(){i.beginPath(),i.fillStyle=a.linesColor,i.strokeStyle=a.linesColor;var c,d=0;n(function(a){"undefined"==typeof c&&(c=a.x),i.lineTo(a.x,a.y),d=a.x}),i.lineWidth=2,i.stroke(),i.lineTo(d,b.y0),i.lineTo("undefined"!=typeof c?c:0,b.y0),i.fill(),i.closePath()}var h=m(j),i=h.getContext("2d");return c(),g(),f(),h}}function m(a){var c=document.createElement("canvas");return c.setAttribute("height",b.height+"px"),c.setAttribute("width",b.width+"px"),c.setAttribute("class",a),c}function n(a){for(var b=0;b<v.length&&a(v[b])!==!1;b++);}function o(a){function b(a){if(4!=a.length)throw"Wrong input format. Array should have 4 elements";return{Type:a[0],Description:a[1],X:a[2],Y:a[3]}}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}for(var d,f,g=0;g<e.length;g++){if(c(e[g]))d=b(e[g]);else{if(d=e[g],!d.hasOwnProperty("Type"))throw"Wrong input format. Object should have the Type property";if(d.hasOwnProperty("Description")||(d.Description=""),isNaN(parseFloat(d.Y)))throw"Wrong input format. Y value can not be parsed as a float"}if(f=Date.parse(d.X),isNaN(f))throw"Wrong input format. Time can not be parsed";a(d.Type,d.Description,f,d.Y)}}function p(){var a=0,c=0,d=Number.MAX_VALUE,f=Number.MAX_VALUE;o(function(b,e,g,h){a=Math.max(g,a),c=Math.max(h,c),d=Math.min(g,d),f=Math.min(h,f)});var g,h,i;return e.length>1?(g=(b.width-2*b.marginX)/(a-d),h=(b.height/b.yK-2*b.marginY)/(c-f),i=(a-d)/b.stepsX):(g=b.width-2*b.marginX/100,h=(b.height/b.yK-2*b.marginY)/100,i=100/b.stepsX),{coefficientX:g,coefficientY:h,x0:parseInt(b.marginX,10),y0:b.height-b.marginY,minX:d,maxX:a,minY:f,stepTime:i,stepX:i*g,stepY:(b.height-2*b.marginY)/b.stepsY}}function q(){var a=[];return o(function(d,e,f,g){a.push(new c(d,e,f,g,b,u))}),a}function r(a){return(a-u.x0)/u.coefficientX+u.minX}function s(a){return(a-u.minX+u.x0/u.coefficientX)*u.coefficientX}function t(a){this.getElement=function(){for(var b=document.createElement("style"),c=".p85-graph-holder {font-family: "+a.fontFamily+"}",d=0;d<a.types.length;d++){var e=a.types[d].color;c+=".p85-graph-point-type"+d+" { border-color: "+e+"; } .p85-graph-point-type"+d+" { border-color: "+e+"; }"}return b.setAttribute("type","text/css"),b.innerHTML=c,b}}this.appendTo=function(a){for(var b=0;b<x.length;b++)a.append(x[b])},this.getInternals=function(){return{timeToX:s,xToTime:r,params:u,points:v,xNotches:w,options:b}},b=f(b);var u=p(),v=q(),w=[],x=[new l(b,u).getCanvas(),new k(b).getCanvas(),new h(b).getCanvas(),new t(b).getElement()]}function c(a,b,c,d,e,f,g){var h,i;return g?(h=c,i=d):(h=f.coefficientX*(c-f.minX)+e.marginX,i=e.height/e.yK-f.coefficientY*(d-f.minY)-e.marginY),{origX:c,origY:d,x:h,y:i,hovered:!1,type:a,descr:b}}function d(a,b){var c,d=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],e={Y:a.getFullYear(),y:a.getFullYear()-(a.getFullYear()>=2e3?2e3:1900),m:a.getMonth()+1,d:a.getDate(),H:a.getHours(),M:a.getMinutes(),S:a.getSeconds(),B:d[a.getMonth()]};for(c in e)e.hasOwnProperty(c)&&(b=b.replace("%"+c,e[c]<10?"0"+e[c]:e[c]));return b}function e(){this.appendTo=function(a){var b=document.createElement("p");b.setAttribute("class",k),a.append(b)}}function f(a){var b={width:1280,height:1024,marginX:50,marginY:50,backgroundColor:"white",axesColor:"#DEDEDE",axesDescriptionColor:"#979797",linesColor:"#D9F1FD",fontFamily:"Tahoma, serif",stepsX:6,stepsY:5,yK:1.5,debug:!1,types:[{color:"#39A8EC",description:"ваша ставка"},{color:"#0457AB",description:"другая компания"}]};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function g(a){switch(a){case"rhomb-tmpl-div":return'<div class="p85-graph-point"></div>';case"rhomb-tmpl-a":return'<a href="#" class="p85-graph-point"></a>';default:return""}}var h="p85-graph-holder",i="p85GraphCanvasFg",j="p85GraphCanvasBg",k="p85GraphStatusBar";a.fn.graph=function(a,c,d){return"internals"===d?b:("undefined"==typeof a&&(a={}),"undefined"==typeof c?this:(this.addClass(h),new b(a,c).appendTo(this),(new e).appendTo(this),this))}}(jQuery);
//# sourceMappingURL=patgod85.graph.min.js.map